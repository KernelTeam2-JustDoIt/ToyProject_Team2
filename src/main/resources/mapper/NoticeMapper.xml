<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team2.mapper.NoticeMapper">


    <!--  최신 공지 가져오기 -->
    <select id="getLatestNotice" resultType="com.team2.dto.notice.NoticeDTO">
        SELECT
            NOTICE_ID AS noticeId,
            WRITER_ADMIN_ID AS writerAdminId,
            NOTICE_TITLE AS title,
            NOTICE_DETAIL AS content,
            POSTED_AT AS postedAt,
            UPDATED_AT AS updatedAt,
            UPDATED_BY AS updatedBy,
            NOTICE_STATUS AS noticeStatus,
            IS_MAIN AS isMain,
            PRIORITY AS priority,
            IS_NEED_PIN AS isNeedPin
        FROM NOTICE
        WHERE  IS_MAIN = 1
        ORDER BY POSTED_AT DESC
            LIMIT 1
    </select>


    <select id="getNoticeList" resultType="com.team2.dto.notice.NoticeDTO">
        SELECT
            NOTICE_ID AS noticeId,
            WRITER_ADMIN_ID AS writerAdminId,
            NOTICE_TITLE AS title,
            NOTICE_DETAIL AS content,
            POSTED_AT AS postedAt,
            UPDATED_AT AS updatedAt,
            UPDATED_BY AS updatedBy,
            NOTICE_STATUS AS noticeStatus,
            IS_MAIN AS isMain,
            PRIORITY AS priority,
            IS_NEED_PIN AS isNeedPin
        FROM NOTICE
        ORDER BY POSTED_AT DESC
            LIMIT #{pageSize} OFFSET #{offset}
    </select>


    <select id="getNoticeDetail" parameterType="int" resultType="com.team2.dto.notice.NoticeDTO">
        SELECT
            NOTICE_ID AS noticeId,
            WRITER_ADMIN_ID AS writerAdminId,
            NOTICE_TITLE AS title,
            NOTICE_DETAIL AS content,
            POSTED_AT AS postedAt,
            UPDATED_AT AS updatedAt,
            UPDATED_BY AS updatedBy,
            NOTICE_STATUS AS noticeStatus,
            IS_MAIN AS isMain,
            PRIORITY AS priority,
            IS_NEED_PIN AS isNeedPin
        FROM NOTICE
        WHERE NOTICE_ID = #{noticeId}
    </select>

    <!-- 공지사항 등록 -->
    <insert id="insertNotice" parameterType="com.team2.dto.notice.NoticeDTO">
        INSERT INTO NOTICE (
            NOTICE_ID,
            WRITER_ADMIN_ID,
            NOTICE_STATUS,
            IS_NEED_PIN,
            PRIORITY,
            NOTICE_TITLE,
            NOTICE_DETAIL,
            POSTED_AT,
            NOTICE_TARGET,
            UPDATED_AT,
            UPDATED_BY,
            IS_MAIN
        )
        VALUES (
                   #{noticeId},
                   #{writerAdminId},
                   #{noticeStatus},
                   #{isNeedPin},
                   #{priority},
                   #{title},
                   #{content},
                   #{postedAt},
                   NULL,
                   #{updatedAt},
                   #{updatedBy},
                   #{isMain}
               )
    </insert>

    <!-- 공지사항 수정 -->
    <update id="updateNotice" parameterType="com.team2.dto.notice.NoticeDTO">
        UPDATE NOTICE
        SET
            NOTICE_TITLE = #{title},
            NOTICE_DETAIL = #{content},
            UPDATED_AT = #{updatedAt},
            UPDATED_BY = #{updatedBy},
            NOTICE_STATUS = #{noticeStatus},
            IS_MAIN = #{isMain},
            PRIORITY = #{priority},
            IS_NEED_PIN = #{isNeedPin}
        WHERE NOTICE_ID = #{noticeId}
    </update>

    <!-- 공지사항 삭제 -->
    <delete id="deleteNotice" parameterType="int">
        DELETE FROM NOTICE
        WHERE NOTICE_ID = #{noticeId}
    </delete>

<!-- 전체 공지 개수 조회 -->
    <select id="countNotices" resultType="int">
        SELECT COUNT(*) FROM NOTICE
    </select>


</mapper>
